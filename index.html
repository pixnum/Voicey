<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voicey - Pro Voice Recorder</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #1e1e2f, #121212);
      color: white;
      overflow: hidden;
      transition: background 0.5s ease;
    }
    body.light {
      background: linear-gradient(135deg, #ffffff, #dcdcdc);
      color: black;
    }
    .recorder-container {
      backdrop-filter: blur(15px) saturate(180%);
      -webkit-backdrop-filter: blur(15px) saturate(180%);
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      width: 360px;
    }
    h1 {
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    button, select, input[type="range"] {
      margin: 6px;
      padding: 10px 15px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.2s, background 0.3s;
    }
    button:hover, select:hover {
      transform: scale(1.05);
    }
    #recordBtn { background: #ff4444; color: white; }
    #pauseBtn { background: #ffbb33; color: black; }
    #stopBtn { background: #33b5e5; color: white; }
    #downloadBtn { background: #00C851; color: white; }
    #darkModeToggle { background: #888; color: white; }
    #timer {
      font-size: 1.2em;
      margin: 10px 0;
    }
    canvas {
      width: 100%;
      height: 80px;
      border-radius: 12px;
      background: rgba(0,0,0,0.2);
      margin-top: 15px;
    }
    .controls {
      margin: 10px 0;
    }
    footer {
      margin-top: 15px;
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="recorder-container">
    <h1>üéôÔ∏è Voicey</h1>

    <div id="timer">00:00:00</div>

    <div class="controls">
      <button id="recordBtn">Start Recording</button>
      <button id="pauseBtn" disabled>Pause</button>
      <button id="stopBtn" disabled>Stop</button>
      <button id="downloadBtn" disabled>Download</button>
    </div>

    <div class="controls">
      <label>Format: 
        <select id="formatSelect">
          <option value="wav">WAV</option>
          <option value="mp3">MP3</option>
        </select>
      </label>
      <label>Bitrate: 
        <select id="bitrateSelect">
          <option value="96000">96 kbps</option>
          <option value="128000" selected>128 kbps</option>
          <option value="192000">192 kbps</option>
        </select>
      </label>
      <label>Sample Rate: 
        <select id="sampleRateSelect">
          <option value="44100" selected>44.1 kHz</option>
          <option value="48000">48 kHz</option>
        </select>
      </label>
    </div>

    <div class="controls">
      <label>Gain: 
        <input type="range" id="gainControl" min="0" max="2" step="0.1" value="1">
      </label>
    </div>

    <canvas id="visualizer"></canvas>

    <audio id="audioPlayback" controls style="width:100%; margin-top:10px;"></audio>

    <div class="controls">
      <button id="darkModeToggle">Toggle Dark Mode</button>
    </div>

    <footer>¬© Voicey 2025</footer>
  </div>

<script>
let mediaRecorder, audioChunks = [], audioUrl;
let audioContext, analyser, source, gainNode;
let startTime, timerInterval;
let canvas = document.getElementById('visualizer');
let ctx = canvas.getContext('2d');

// Timer
function startTimer() {
  startTime = Date.now();
  timerInterval = setInterval(() => {
    let elapsed = Date.now() - startTime;
    let seconds = Math.floor(elapsed / 1000) % 60;
    let minutes = Math.floor(elapsed / (1000*60)) % 60;
    let hours = Math.floor(elapsed / (1000*60*60));
    document.getElementById('timer').textContent =
      String(hours).padStart(2,'0') + ":" +
      String(minutes).padStart(2,'0') + ":" +
      String(seconds).padStart(2,'0');
  }, 1000);
}
function stopTimer() {
  clearInterval(timerInterval);
}

// Start Recording
document.getElementById('recordBtn').onclick = async () => {
  let stream = await navigator.mediaDevices.getUserMedia({
    audio: {
      echoCancellation: true,
      noiseSuppression: true
    }
  });

  audioContext = new (window.AudioContext || window.webkitAudioContext)({
    sampleRate: parseInt(document.getElementById('sampleRateSelect').value)
  });

  source = audioContext.createMediaStreamSource(stream);
  analyser = audioContext.createAnalyser();
  gainNode = audioContext.createGain();
  gainNode.gain.value = document.getElementById('gainControl').value;

  source.connect(gainNode).connect(analyser).connect(audioContext.destination);

  mediaRecorder = new MediaRecorder(stream, {
    mimeType: 'audio/webm;codecs=opus',
    audioBitsPerSecond: parseInt(document.getElementById('bitrateSelect').value)
  });

  audioChunks = [];
  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.onstop = () => {
    let blob = new Blob(audioChunks, { type: 'audio/webm' });
    audioUrl = URL.createObjectURL(blob);
    document.getElementById('audioPlayback').src = audioUrl;

    let now = new Date();
    let filename = `Voicey_${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}-${String(now.getMinutes()).padStart(2,'0')}-${String(now.getSeconds()).padStart(2,'0')}.${document.getElementById('formatSelect').value}`;
    document.getElementById('downloadBtn').onclick = () => {
      const a = document.createElement('a');
      a.href = audioUrl;
      a.download = filename;
      a.click();
    };
    document.getElementById('downloadBtn').disabled = false;
  };

  mediaRecorder.start();
  startTimer();
  drawVisualizer();

  document.getElementById('recordBtn').disabled = true;
  document.getElementById('pauseBtn').disabled = false;
  document.getElementById('stopBtn').disabled = false;
};

// Pause / Resume
document.getElementById('pauseBtn').onclick = () => {
  if (mediaRecorder.state === 'recording') {
    mediaRecorder.pause();
    stopTimer();
    document.getElementById('pauseBtn').textContent = 'Resume';
  } else if (mediaRecorder.state === 'paused') {
    mediaRecorder.resume();
    startTimer();
    document.getElementById('pauseBtn').textContent = 'Pause';
  }
};

// Stop
document.getElementById('stopBtn').onclick = () => {
  mediaRecorder.stop();
  stopTimer();
  document.getElementById('recordBtn').disabled = false;
  document.getElementById('pauseBtn').disabled = true;
  document.getElementById('pauseBtn').textContent = 'Pause';
  document.getElementById('stopBtn').disabled = true;
};

// Gain Control
document.getElementById('gainControl').oninput = (e) => {
  if (gainNode) gainNode.gain.value = e.target.value;
};

// Visualizer
function drawVisualizer() {
  requestAnimationFrame(drawVisualizer);
  let bufferLength = analyser.frequencyBinCount;
  let dataArray = new Uint8Array(bufferLength);
  analyser.getByteFrequencyData(dataArray);

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  let barWidth = (canvas.width / bufferLength) * 2.5;
  let x = 0;
  for (let i = 0; i < bufferLength; i++) {
    let barHeight = dataArray[i]/2;
    ctx.fillStyle = 'rgb(' + (barHeight+100) + ',50,200)';
    ctx.fillRect(x, canvas.height - barHeight/2, barWidth, barHeight);
    x += barWidth + 1;
  }
}

// Dark Mode
document.getElementById('darkModeToggle').onclick = () => {
  document.body.classList.toggle('light');
};
</script>
</body>
</html>
